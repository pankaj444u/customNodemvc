var LocalStrategy=require("passport-local").Strategy,User=require("../models/user"),bCrypt=require("bcrypt-nodejs"),BaseDAO=require("../BaseDao");module.exports=function(e){e.use("login",new LocalStrategy({passReqToCallback:!0},function(e,n,o,r){BaseDAO.db_connect_P(function(a){a?r(a):User.findOne({username:n},function(a,t){return a?r(a):t?s(t,o)?(BaseDAO.db_disconnect(),r(null,t)):(BaseDAO.db_disconnect(),console.log("Invalid Password"),r(null,!1,e.flash("message","Invalid Password"))):(BaseDAO.db_disconnect(),console.log("User Not Found with username "+n),r(null,!1,e.flash("message","User Not found.")))})})}));var s=function(e,s){return bCrypt.compareSync(s,e.password)}};