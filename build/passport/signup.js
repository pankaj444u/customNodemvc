var LocalStrategy=require("passport-local").Strategy,User=require("../models/user"),bCrypt=require("bcrypt-nodejs"),BaseDAO=require("../BaseDao");module.exports=function(e){e.use("signup",new LocalStrategy({passReqToCallback:!0},function(e,n,s,o){findOrCreateUser=function(){BaseDAO.db_connect(),User.findOne({username:n},function(a,t){if(a)return console.log("Error in SignUp: "+a),BaseDAO.db_disconnect(),o(a);if(t)return BaseDAO.db_disconnect(),console.log("User already exists with username: "+n),o(null,!1,e.flash("message","User Already Exists"));var c=new User;c.username=n,c.password=r(s),c.save(function(e){if(e)throw BaseDAO.db_disconnect(),console.log("Error in Saving user: "+e),e;return BaseDAO.db_disconnect(),console.log("User Registration succesful"),o(null,c)})})},process.nextTick(findOrCreateUser)}));var r=function(e){return bCrypt.hashSync(e,bCrypt.genSaltSync(10),null)}};